!function(t,e){if("function"==typeof define&&define.amd)define(["mk-ui"],function(o){return e(t,o)});else{if("object"!=typeof module||!module.exports)return e(t,t.Mk);module.exports=e(t,require("mk-ui"))}}("undefined"!=typeof window&&window||this,function(t,e){return e.create("Tooltip",{name:"mk-tt",xrel:/^relative|absolute|fixed$/i,xfocus:/^a|button|input|select|textarea$/i,focusSelector:"a, button, input, select, textarea, table, iframe",templates:{modal:'<span class="{{$key}}-modal">{{html}}</span>',kill:'<button class="{{$key}}-kill" role="presentation"></button>'},map:{"left-center":function(t,e,o){var i=o&&o.left||0,n=o&&o.top||0;return{left:e.left-t.width-t.box.left-t.box.right+i,top:e.top+e.height/2-t.height/2-t.box.top+n}},"left-top":function(t,e,o){var i=o&&o.left||0,n=o&&o.top||0;return{left:e.left-t.width-t.box.left-t.box.right+i,top:e.top-t.box.top+n}},"left-bottom":function(t,e,o){var i=o&&o.left||0,n=o&&o.top||0;return{left:e.left-t.width-t.box.left-t.box.right+i,top:e.top+e.height-t.height-t.box.top+n}},"right-center":function(t,e,o){var i=o&&o.left||0,n=o&&o.top||0;return{left:e.left+e.width+i,top:e.top+e.height/2-t.height/2-t.box.top+n}},"right-top":function(t,e,o){var i=o&&o.left||0,n=o&&o.top||0;return{left:e.left+e.width+i,top:e.top-t.box.top+n}},"right-bottom":function(t,e,o){var i=o&&o.left||0,n=o&&o.top||0;return{left:e.left+e.width+i,top:e.top+e.height-t.height-t.box.top+n}},"top-left":function(t,e,o){var i=o&&o.left||0,n=o&&o.top||0;return{left:e.left-t.box.left+i,top:e.top-t.height-(t.box.bottom+t.box.top)+n}},"top-center":function(t,e,o){var i=o&&o.left||0,n=o&&o.top||0;return{left:e.left+e.width/2-t.width/2-t.box.left+i,top:e.top-t.height-(t.box.bottom+t.box.top)+n}},"top-right":function(t,e,o){var i=o&&o.left||0,n=o&&o.top||0;return{left:e.left+e.width-t.width-t.box.right+i,top:e.top-t.height-(t.box.bottom+t.box.top)+n}},"bottom-left":function(t,e,o){var i=o&&o.left||0,n=o&&o.top||0;return{left:e.left-t.box.left+i,top:e.top+e.height+n}},"bottom-center":function(t,e,o){var i=o&&o.left||0,n=o&&o.top||0;return{left:e.left+e.width/2-t.width/2-t.box.left+i,top:e.top+e.height+n}},"bottom-right":function(t,e,o){var i=o&&o.left||0,n=o&&o.top||0;return{left:e.left+e.width-t.width-t.box.right+i,top:e.top+e.height+n}}},getArrowOffset:function(t,e,o){var i={left:0,top:0};if(this.config.useArrowCenter)switch(o){case"top-left":case"bottom-left":i.left=-this.config.arrowOffsets.horz+e.width/2;break;case"top-right":case"bottom-right":i.left=this.config.arrowOffsets.horz-e.width/2;break;case"right-top":case"left-top":i.top=-this.config.arrowOffsets.vert+e.height/2;break;case"right-bottom":case"left-bottom":i.top=this.config.arrowOffsets.vert-e.height/2}return i},get version(){return"v2.0.0"},configure:function(t){return this.config.map={},this.each(this.map,function(t,e){this.config.map[e]=t}),t=t||{},t.position=t.position||"top-center",t.delay=parseInt(t.delay||"200",10)||200,t.useArrowCenter=t.useArrowCenter||!1,t.arrowOffsets=t.arrowOffsets||{},t.arrowOffsets.horz=t.arrowOffsets.horz||0,t.arrowOffsets.vert=t.arrowOffsets.vert||0,this.super(t)},unmount:function(){var t=this.root;this.each("click,mouseenter,mouseleave,focus,blur,keyup".split(","),function(e){t.off(e+".mk")}),this.root=this.config=null},bind:function(){var t=this,e=this.selector();this.selector("modal");this.device||this.root.on("mouseenter.mk",e,function(e){e.preventDefault(),t._focus(this,e,!1)}).on("mouseleave.mk",e,function(e){e.preventDefault(),t._blur(this,e,!1)}),this.root.on("click.mk",e,function(e){e.preventDefault(),t._click(this)}).on("focus.mk",e,function(e){e.preventDefault(),t._focus(this,e,!0)}).on("blur.mk",e,function(e){e.preventDefault(),t._blur(this,e,!0)}).on("keyup.mk",e,function(e){t._keyup(e,this)})},_keyup:function(t,e){t.which===this.keycode.esc&&this.hide(e)},_click:function(t){(this.device||"click"===this.$(t).data("action"))&&this.toggle(t)},_focus:function(t,e,o){"click"!==this.$(t).data("action")&&this.show(t)},_blur:function(t,e,o){if(this.$(e.relatedTarget||document.activeElement).parent(this.selector("modal")).length)return void this._bindModalBlur(t);(o||!o&&"click"!==this.$(t).data("action"))&&this.hide(t)},_bindModalBlur:function(t){var e=this.modal(t),o=this;e.on("blur.mk",!0,function(i){var n=i.relatedTarget||document.activeElement;(!n||o.$(n).parent(e).length<1)&&(e.off("blur.mk"),n||o.hide(t))})},_bindModalDown:function(t,e){var o=this;e.on("mousedown.mk",function(t){if(!o.xfocus.test(t.target))return t.preventDefault(),t.stopPropagation(),!1}),e.on("click.mk",'[data-action="close"]',function(e){e.preventDefault(),o.hide(t)})},_unbindModalDown:function(t){t.off("mousedown.mk"),t.off("click.mk")},_relative:function(t,e,o){var i,n={left:e,top:o};return t.parent&&(i=this.offset(t.parent),n.left=e+i.left,n.top=o+i.top,i.parent)?this._relative(i,n.left,n.top):n},_adjust:function(t,e){if(!e.ajusted&&t.parent!==e.parent){var o=this.offset(t.parent,!0),i=this.offset(e.parent,!0);e.top=i.top-o.top+e.top,e.left=i.left-o.left+e.left,e.ajusted=!0}},_cycles:{topBottom:["top-center","bottom-center","top-left","bottom-left","top-right","bottom-right"],rightLeft:["right-center","left-center","right-top","left-top","right-bottom","left-bottom"]},_position:function(t,e,o,i,n){if(t=t.toLowerCase(),!n){var s=/^top-/i.test(t)||/^bottom-/i.test(t),r=/^left-/i.test(t)||/^right-/i.test(t);n={bestFit:{lowest:9e3,coords:null},count:0,origKey:t,items:{},favorTopBottom:s,favorLeftRight:r,cycle:r?this._cycles.leftRight:this._cycles.topBottom};var a=n.cycle.indexOf(t);n.cycleIndex=a>=0?a:0}var f=Math.min(n.cycle.length,6);if(n.count<f){var l=this.config.map.hasOwnProperty(t)&&this.config.map[t]||null;if(l){this._adjust(e,o);var h,c=this.getArrowOffset(e,o,t),u=l(e,o,c),d=u.left,p=u.top,m=e.width,b=e.height;u.key=t;var g;o.parent&&e.parent===o.parent?(h=this._relative(e,d,p),g={top:Math.max(i.top-h.top,0),left:Math.max(i.left-h.left,0),right:Math.max(h.left+m-i.width,0),bottom:Math.max(h.top+b-i.height,0)}):g={top:Math.max(i.top-p,0),left:Math.max(i.left-d,0),right:Math.max(d+m-i.width,0),bottom:Math.max(p+b-i.height,0)},n.items[t]={amountOver:g,coords:u},n.count++;var v=g.top+g.right+g.bottom;if(g.left<=0&&v<n.bestFit.lowest?(n.bestFit.lowest=v,n.bestFit.coords=u):n.bestFit.coords||(n.bestFit.lowest=v+g.left+5e3,n.bestFit.coords=u,n.bestFit.coords.left+=g.left),n.bestFit.lowest>0){var w=++n.cycleIndex%n.cycle.length;return t=n.cycle[w],this._position(t,e,o,i,n)}return u}}return n.bestFit.coords},isFocusable:function(t){return"dialog"===t.attr("role")||(t.find(this.focusSelector).length>0||this.first(t.find("[tabindex]"),function(t){if(t.tabindex>-1)return!0}))},link:function(t){var e,o=this.$(t),i=this.$("#"+o.attr("aria-describedby"));if(i.length<1){var n=this.uid(),s=o.attr("aria-label");s?(i=this.html("modal",{html:s}).appendTo(o),o.attr("aria-label","")):(i=o.find(this.selector("modal")),i.length<1&&(i=o.parent().find(this.selector("modal"))),n=i.attr("id")||n),i.attr("id",n)}return e=i.attr("aria-hidden"),e||i.attr("aria-hidden","true"),this.connect(o,i)},connect:function(t,e){if(e.data(this.name+"-connected"))return this;var o,i="tooltip";return this.isFocusable(e)&&(i="dialog",o=t.attr("id"),o||(o=this.uid(),t.attr("id",o)),e.attr("aria-labelledby",o)),e.attr("role",i),t.attr("aria-describedby",e.attr("id")),this.transitions&&e.addClass("transitions"),e.data(this.name+"-connected",!0),this.emit("connect",t[0],e[0]),this},box:function(t){var e={top:0,left:0,right:0,bottom:0};if(t){var o=getComputedStyle(t);this.each(e,function(t,i){e[i]=parseFloat(o.getPropertyValue("margin-"+i),10)})}return e},offset:function(t,e){var o,i=this.$(t)[0],n=this.xrel,s={left:0,top:0,width:0,height:0,box:this.box(i)};if(i){var r=i;for(s.node=i,s.left=i.offsetLeft,s.top=i.offsetTop,s.width=i.offsetWidth,s.height=i.offsetHeight,s.parent=i.offsetParent;i.offsetParent&&e;)i=i.offsetParent,o=getComputedStyle(i),!0===n.test(o.getPropertyValue("position"))&&(s.left+=i.offsetLeft,s.top+=i.offsetTop),s.parent=i;for(var a=r.parentNode;a&&"BODY"!==a.tagName&&"HTML"!==a.tagName&&(e||a!==s.parent);)a.scrollTop&&(s.top-=a.scrollTop),a.scrollLeft&&(s.left-=a.scrollLeft),a=a.parentNode}return s},frame:function(t){var e=document.documentElement,o=document.body,i=this.$(t)[0],n=i;if(i){for(;i.scrollTop<=0&&i!==o;)i=i.parentNode,n=i;return i===o&&(i.scrollTop<e.scrollTop||i.scrollLeft<e.scrollLeft)&&(n=e),{node:i,top:n.scrollTop,left:n.scrollLeft,scroll:n.scrollTop,width:i.offsetWidth,height:i.offsetHeight}}return{node:null}},position:function(t,e){var o,i=t.attr("data-position")||this.config.position;if("none"!==i){e.css({width:"",left:"",top:""});var n=this.offset(e),s=this.offset(t),r=this.frame(e);if(this.config.useFixedWidth&&e.css({width:n.width+1}),o=this._position(i,n,s,r)){this.each(this.config.map,function(t,o){e.removeClass(o)}),e.addClass(o.key),this.emit("position",t[0],e[0],o),e.css({left:o.left,top:o.top});var a=n.node.offsetHeight-n.height;0!==a&&/^top-/i.test(o.key)&&e.css({top:o.top-a})}}return this},modal:function(t){var e,o=this.$(t),i=o.attr("aria-describedby")||"";return i?(e=this.$("#"+i),this.connect(o,e),e):this.link(t).modal(t)},focus:function(t,e){var o=e.find(this.selector("kill"));return o.length<1&&(o=this.html("kill"),o.on("focus.mk",function(){t.focus()}),e.append(o)),this},show:function(t){var e,o=this.$(t);return this.unlocked(o)&&this.isHidden(o)&&(this.hideAll(),e=this.modal(t),this.delay(function(){e.removeClass("out").addClass("in").attr("aria-hidden","false"),this.position(o,e),this._bindModalDown(o,e),this.isFocusable(e)&&this.focus(o,e),o.addClass("active"),this.emit("show",o[0],e[0])}),this.transition(e,function(t,e){e.removeClass("in")})),this},hide:function(t,e){var o,i,n=this.$(t),s=n.attr("data-action");return this.unlocked(n)&&this.isOpen(n)&&(o=this.modal(t),i=!0!==e&&"click"!==s&&this.isFocusable(o)&&this.config.delay||1,this.delay(function(){o.removeClass("in").addClass("out").attr("aria-hidden","true"),this._unbindModalDown(o),!0!==e&&this.transitions||(o.removeClass("out"),this.clearTransitions(o)),n.removeClass("active"),this.emit("hide",n[0],o[0])},i),this.transition(o,function(t,e){e.removeClass("out")})),this},hideAll:function(){var t=this.$(this.selector());return this.each(t,function(t){this.isOpen(t)&&this.hide(t,!0)})},toggle:function(t){return this.isOpen(t)?this.hide(t):this.show(t)},isOpen:function(t){return!this.isHidden(t)},isHidden:function(t){return"false"!==this.modal(t).attr("aria-hidden")},lock:function(t){var e=this.$(t);return e.hasClass(this.name)&&!e.hasClass("locked")&&(e.addClass("locked"),this.emit("lock",e[0],!0)),this},unlock:function(t){var e=this.$(t);return e.hasClass(this.name)&&e.hasClass("locked")&&(e.removeClass("locked"),this.emit("lock",e[0],!1)),this},locked:function(t){return this.$(t).hasClass("locked")},unlocked:function(t){return!0!==this.$(t).hasClass("locked")}}),e.get("Tooltip")});
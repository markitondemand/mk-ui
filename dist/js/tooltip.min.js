!function(t,e){if("function"==typeof define&&define.amd)define(["mk-ui"],function(i){return e(t,i)});else{if("object"!=typeof module||!module.exports)return e(t,t.Mk);module.exports=e(t,require("mk-ui"))}}("undefined"!=typeof window&&window||this,function(t,e){return e.create("Tooltip",{name:"mk-tt",xrel:/^relative|absolute|fixed$/i,xfocus:/^a|button|input|select|textarea$/i,focusSelector:"a, button, input, select, textarea, table, iframe",templates:{modal:'<span class="{{$key}}-modal">{{html}}</span>',kill:'<button class="{{$key}}-kill" role="presentation"></button>'},map:{"left-center":function(t,e){return{left:e.left-t.width-t.box.left-t.box.right,top:e.top+e.height/2-t.height/2-t.box.top}},"left-top":function(t,e){return{left:e.left-t.width-t.box.left-t.box.right,top:e.top-t.box.top}},"left-bottom":function(t,e){return{left:e.left-t.width-t.box.left-t.box.right,top:e.top+e.height-t.height-t.box.top}},"right-center":function(t,e){return{left:e.left+e.width,top:e.top+e.height/2-t.height/2-t.box.top}},"right-top":function(t,e){return{left:e.left+e.width,top:e.top-t.box.top}},"right-bottom":function(t,e){return{left:e.left+e.width,top:e.top+e.height-t.height-t.box.top}},"top-left":function(t,e){return{left:e.left-t.box.left,top:e.top-t.height-(t.box.bottom+t.box.top)}},"top-center":function(t,e){return{left:e.left+e.width/2-t.width/2-t.box.left,top:e.top-t.height-(t.box.bottom+t.box.top)}},"top-right":function(t,e){return{left:e.left+e.width-t.width-t.box.right,top:e.top-t.height-(t.box.bottom+t.box.top)}},"bottom-left":function(t,e){return{left:e.left-t.box.left,top:e.top+e.height}},"bottom-center":function(t,e){return{left:e.left+e.width/2-t.width/2-t.box.left,top:e.top+e.height}},"bottom-right":function(t,e){return{left:e.left+e.width-t.width-t.box.right,top:e.top+e.height}}},get version(){return"v2.0.0"},configure:function(t){return this.config.map={},this.each(this.map,function(t,e){this.config.map[e]=t}),t=t||{},t.position=t.position||"top-center",t.delay=parseInt(t.delay||"200",10)||200,this.super(t)},unmount:function(){var t=this.root;this.each("click,mouseenter,mouseleave,focus,blur,keyup".split(","),function(e){t.off(e+".mk")}),this.root=this.config=null},bind:function(){var t=this,e=this.selector();this.selector("modal");this.device||this.root.on("mouseenter.mk",e,function(e){e.preventDefault(),t._focus(this,e,!1)}).on("mouseleave.mk",e,function(e){e.preventDefault(),t._blur(this,e,!1)}),this.root.on("click.mk",e,function(e){e.preventDefault(),t._click(this)}).on("focus.mk",e,function(e){e.preventDefault(),t._focus(this,e,!0)}).on("blur.mk",e,function(e){e.preventDefault(),t._blur(this,e,!0)}).on("keyup.mk",e,function(e){t._keyup(e,this)})},_keyup:function(t,e){t.which===this.keycode.esc&&this.hide(e)},_click:function(t){(this.device||"click"===this.$(t).data("action"))&&this.toggle(t)},_focus:function(t,e,i){"click"!==this.$(t).data("action")&&this.show(t)},_blur:function(t,e,i){var o=this.$(e.relatedTarget);return o.parent(this.selector("modal")).length?void this._bindModalBlur(t):void((i||!i&&"click"!==this.$(t).data("action"))&&this.hide(t))},_bindModalBlur:function(t){var e=this.modal(t),i=this;e.on("blur.mk",!0,function(o){var n=o.relatedTarget;(!n||i.$(n).parent(e).length<1)&&(e.off("blur.mk"),n||i.hide(t))})},_bindModalDown:function(t,e){var i=this;e.on("mousedown.mk",function(t){if(!i.xfocus.test(t.target))return t.preventDefault(),t.stopPropagation(),!1}),e.on("click.mk",'[data-action="close"]',function(e){e.preventDefault(),i.hide(t)})},_unbindModalDown:function(t){t.off("mousedown.mk"),t.off("click.mk")},_relative:function(t,e,i){var o,n={left:e,top:i};return t.parent&&(o=this.offset(t.parent),n.left=e+o.left,n.top=i+o.top,o.parent)?this._relative(o,n.left,n.top):n},_adjust:function(t,e){if(!e.ajusted&&t.parent!==e.parent){var i=this._relative(e,e.left,e.top);e.left=i.left,e.top=i.top,e.ajusted=!0}},_position:function(t,e,i,o,n){if(t=t.toLowerCase(),n=n||0,n<5){var s=this.config.map.hasOwnProperty(t)&&this.config.map[t]||null;if(s){this._adjust(e,i);var r,l=s(e,i),a=l.left,h=l.top;return l.key=t,i.parent&&e.parent===i.parent&&(r=this._relative(i,a,0),a=r.left,h=r.top+i.top-e.height),a<o.left?t=/^left/i.test(t)&&t.replace(/left/,"right")||t.replace(/center/,"left"):a>o.width&&(t=/^right/.test(t)&&t.replace(/right/,"left")||t.replace(/center/,"right")),h<o.top?t=t.replace(/top/,"bottom"):h>o.height&&(t=t.replace(/bottom/,"top")),t!==l.key?this._position(t,e,i,o,++n):l}}return null},isFocusable:function(t){return"dialog"===t.attr("role")||(t.find(this.focusSelector).length>0||this.first(t.find("[tabindex]"),function(t){if(t.tabindex>-1)return!0}))},link:function(t){var e,i=this.$(t),o=this.$("#"+i.attr("aria-describedby"));if(o.length<1){var n=this.uid(),s=i.attr("aria-label");s?(o=this.html("modal",{html:s}).appendTo(i),i.attr("aria-label","")):(o=i.find(this.selector("modal")),o.length<1&&(o=i.parent().find(this.selector("modal"))),n=o.attr("id")||n),o.attr("id",n)}return e=o.attr("aria-hidden"),e||o.attr("aria-hidden","true"),this.connect(i,o)},connect:function(t,e){if(e.data(this.name+"-connected"))return this;var i,o="tooltip";return this.isFocusable(e)&&(o="dialog",i=t.attr("id"),i||(i=this.uid(),t.attr("id",i)),e.attr("aria-labelledby",i)),e.attr("role",o),t.attr("aria-describedby",e.attr("id")),this.transitions&&e.addClass("transitions"),e.data(this.name+"-connected",!0),this.emit("connect",t[0],e[0]),this},box:function(t){var e={top:0,left:0,right:0,bottom:0};if(t){var i=getComputedStyle(t);this.each(e,function(t,o){e[o]=parseFloat(i.getPropertyValue("margin-"+o),10)+parseFloat(i.getPropertyValue("border-"+o+"-width"),10)})}return e},offset:function(t,e){var i,o=this.$(t)[0],n=this.xrel,s={left:0,top:0,width:0,height:0,box:this.box(o)};if(o){s.left=o.offsetLeft,s.top=o.offsetTop,s.width=o.offsetWidth,s.height=o.offsetHeight;for(var r=o;(r=r.parentNode)&&"BODY"!==r.tagName;)r.scrollTop&&(s.top-=r.scrollTop),r.scrollLeft&&(s.left-=r.scrollLeft);for(;o=o.offsetParent;)i=getComputedStyle(o),n.test(i.getPropertyValue("position"))!==!0?(s.left+=o.offsetLeft,s.top+=o.offsetTop):s.parent=o}return s},frame:function(t){var e=document.documentElement,i=document.body,o=this.$(t)[0],n=o;if(o){for(;o.scrollTop<=0&&o!==i;)o=o.parentNode,n=o;return o===i&&(o.scrollTop<e.scrollTop||o.scrollLeft<e.scrollLeft)&&(n=e),{node:o,top:n.scrollTop,left:n.scrollLeft,scroll:n.scrollTop,width:o.offsetWidth,height:o.offsetHeight}}return{node:null}},position:function(t,e){var i,o=t.attr("data-position")||this.config.position;return"none"!==o&&(i=this._position(o,this.offset(e,!0),this.offset(t),this.frame(e)),i&&(this.each(this.config.map,function(t,i){e.removeClass(i)}),e.addClass(i.key),this.emit("position",t[0],e[0],i),e.css({left:i.left,top:i.top}))),this},modal:function(t){var e,i=this.$(t),o=i.attr("aria-describedby")||"";return o?(e=this.$("#"+o),this.connect(i,e),e):this.link(t).modal(t)},focus:function(t,e){var i=e.find(this.selector("kill"));return i.length<1&&(i=this.html("kill"),i.on("focus.mk",function(){t.focus()}),e.append(i)),this},show:function(t){var e,i=this.$(t);return this.unlocked(i)&&this.isHidden(i)&&(this.hideAll(),e=this.modal(t),this.delay(function(){e.removeClass("out").addClass("in").attr("aria-hidden","false"),this.position(i,e),this._bindModalDown(i,e),this.isFocusable(e)&&this.focus(i,e),i.addClass("active"),this.emit("show",i[0],e[0])}),this.transition(e,function(t,e){e.removeClass("in")})),this},hide:function(t,e){var i,o,n=this.$(t),s=n.attr("data-action");return this.unlocked(n)&&this.isOpen(n)&&(i=this.modal(t),o=e!==!0&&"click"!==s&&this.isFocusable(i)&&this.config.delay||1,this.delay(function(){i.removeClass("in").addClass("out").attr("aria-hidden","true"),this._unbindModalDown(i),e!==!0&&this.transitions||(i.removeClass("out"),this.clearTransitions(i)),n.removeClass("active"),this.emit("hide",n[0],i[0])},o),this.transition(i,function(t,e){e.removeClass("out")})),this},hideAll:function(){var t=this.$(this.selector());return this.each(t,function(t){this.isOpen(t)&&this.hide(t,!0)})},toggle:function(t){return this.isOpen(t)?this.hide(t):this.show(t)},isOpen:function(t){return!this.isHidden(t)},isHidden:function(t){return"false"!==this.modal(t).attr("aria-hidden")},lock:function(t){var e=this.$(t);return e.hasClass(this.name)&&!e.hasClass("locked")&&(e.addClass("locked"),this.emit("lock",e[0],!0)),this},unlock:function(t){var e=this.$(t);return e.hasClass(this.name)&&e.hasClass("locked")&&(e.removeClass("locked"),this.emit("lock",e[0],!1)),this},locked:function(t){return this.$(t).hasClass("locked")},unlocked:function(t){return this.$(t).hasClass("locked")!==!0}}),e.get("Tooltip")});
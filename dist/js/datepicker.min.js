!function(t,e){if("function"==typeof define&&define.amd)define(["mk-ui"],function(a){return e(t,a)});else{if("object"!=typeof module||!module.exports)return e(t,t.Mk);module.exports=e(t,require("mk-ui"))}}("undefined"!=typeof window&&window||this,function(t,e){function a(t){return 32-new Date(t.getFullYear(),t.getMonth(),32).getDate()}function s(t){var e=new Date;return e.setDate(1),e.setMonth(t.getMonth()-1),e.setFullYear(t.getFullYear()),a(e)}function i(t){return new Date(t.getFullYear(),t.getMonth(),1).getDay()}return e.create("Datepicker",{name:"mk-dp",index:-1,xSplit:/\/|-|,\s|\s/,xSearch:/(^|\w+)(\/|-|,\s|\s|$)/g,MIN:-864e13,MAX:864e13,uidate:null,date:null,daterange:null,min:null,max:null,formatmap:{months:["january","february","march","april","may","june","july","august","september","october","november","december"],days:["sunday","monday","tuesday","wednesday","thursday","friday","saturday"]},formats:{native:"yyyy-mm-dd",date:"mm/dd/yyyy",days:"d",month:"mmmm",year:"yyyy",nextMo:"Go to next month",nextYr:"Go to next year",prevMo:"Go to previous month",prevYr:"Go to previous year",caption:"{{month}} {{year}}",label:"{{month}} {{day}} {{year}}",label_day:"Enter a {{digit}} character day",label_month:"Enter a {{digit}} character month",label_year:"Enter a {{digit}} character year"},templates:{shadow:'<div class="{{$key}}-shadow">\t\t\t\t\t{{template:input}}\t\t\t\t\t{{template:access}}\t\t\t\t\t{{template:calendar}}\t\t\t\t</div>',input:'<div class="{{$key}}-input">\t\t\t\t\t{{loop:inputs}}\t\t\t\t\t\t<input class="{{$key}}-entry {{id}}" \t\t\t\t\t\t\tplaceholder="{{placeholder}}" \t\t\t\t\t\t\ttype="{{type}}" \t\t\t\t\t\t\tname="{{name}}" \t\t\t\t\t\t\tvalue="{{value}}" \t\t\t\t\t\t\taria-label="{{label}}" \t\t\t\t\t\t\tdata-format="{{format}}" \t\t\t\t\t\t\tdata-key="{{id}}" />\t\t\t\t\t\t<span class="spacer">{{spacer}}</span>\t\t\t\t\t{{/loop:inputs}}\t\t\t\t</div>',calendar:'<div class="{{$key}}-calendar">\t\t\t\t\t{{template:controls}}\t\t\t\t\t{{template:table}}\t\t\t\t</div>',controls:'<div class="{{$key}}-controls">\t\t\t\t\t<button class="{{$key}}-control prev-yr" aria-label="Go to previous year"></button>\t\t\t\t\t<button class="{{$key}}-control prev-mo" aria-label="Go to previous month"></button>\t\t\t\t\t<button class="{{$key}}-control next-mo" aria-label="Go to next month"></button>\t\t\t\t\t<button class="{{$key}}-control next-yr" aria-label="Go to next year"></button>\t\t\t\t</div>',table:'<table class="{{$key}}-table">\t\t\t\t\t<caption class="{{$key}}-heading" aria-atomic="true" aria-live="assertive">{{title}}</caption>\t\t\t\t\t<thead class="{{$key}}-head">\t\t\t\t\t\t<tr>\t\t\t\t\t\t{{loop:days}}\t\t\t\t\t\t\t<th aria-label="{{day}}">{{label}}</th>\t\t\t\t\t\t{{/loop:days}}\t\t\t\t\t\t</tr>\t\t\t\t\t</thead>\t\t\t\t\t{{template:body}}\t\t\t\t</table>',body:'<tbody class="{{$key}}-body" tabindex="0">\t\t\t\t\t{{loop:weeks}}\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t{{loop:days}}\t\t\t\t\t\t\t\t{{template:day}}\t\t\t\t\t\t\t{{/loop:days}}\t\t\t\t\t\t</tr>\t\t\t\t\t{{/loop:weeks}}\t\t\t\t</tbody>',day:'<td data-value="{{value}}" class="\t\t\t\t\t{{day}} {{$key}}-day\t\t\t\t\t{{if:selectable}} selectable{{/if:selectable}}\t\t\t\t\t{{if:today}} today{{/if:today}}\t\t\t\t\t{{if:active}} active{{/if:active}}\t\t\t\t\t{{if:weekend}} weekend{{/if:weekend}}\t\t\t\t\t{{if:inactive}} inactive{{/if:inactive}}\t\t\t\t\t{{if:disabled}} disabled{{/if:disabled}}\t\t\t\t\t{{if:between}} between{{/if:between}}\t\t\t\t\t{{if:rollover}} rollover{{/if:rollover}}\t\t\t\t\t" aria-label="{{label}}">\t\t\t\t\t<span>{{value}}</span>\t\t\t\t</td>',access:'<button class="{{$key}}-access" aria-label="Open Calendar Interface"></button>'},get disabled(){return this.rootinput.prop("disabled")},get enabled(){return!this.disabled},get value(){return this.dts(this.selected)},get range(){return[]},get rootinput(){return this.node("")},get input(){return this.node("input",this.shadow)},get month(){return this.node("entry.month",this.shadow)},get day(){return this.node("entry.day",this.shadow)},get year(){return this.node("entry.year",this.shadow)},get accessbtn(){return this.node("access",this.shadow)},get calendar(){return this.node("calendar",this.shadow)},get days(){return this.node("day.selectable",this.shadow)},get controls(){return this.node("control",this.shadow)},get heading(){return this.node("heading",this.shadow)},get matician(){return this.node("matician",this.root)},get activeDay(){var t=this.node("body",this.calendar),e=t.find(".active");return e.length||(e=t.find('[data-value="'+this.date.getDate()+'"]')),e.length||(e=t.find(".today")),e},configure:function(t){t=t||{};var e=this.rootinput;t.fdate=e.val(),t.fmin=e.attr("min"),t.fmax=e.attr("max"),this.date=t.fdate&&this.std(t.fdate)||new Date,this.selected=t.fdate&&this.std(t.fdate)||new Date("garbage"),this.min=t.fmin&&this.std(t.fmin)||null,this.max=t.fmax&&this.std(t.fmax)||null,this.param("format","string",t,this.formats.date,e).param("rollover","boolean",t,!0,e),this.super(t)},build:function(){this.shadow=this.html("shadow",this.data())},mount:function(){this.shadow.appendTo(this.root)},unmount:function(){this.shadow.remove(),this.config=this.shadow=this.date=this.root=null},bind:function(){var t=this,e=!1;this.input.on("focus.mk","input",function(t){this.setSelectionRange(0,this.value.length)}).on("blur.mk","input",function(e){t._validate(e.target)}).on("keydown.mk","input",function(e){t._keydownInput(e)}),this.calendar.on("focus.mk",!0,function(a){e=t.$(a.target).is(t.selector("body"))}).on("keydown.mk",!0,function(a){t._keydownCalendar(a,e)}).on("click.mk",!0,function(e){e.preventDefault(),t._click(e)}).on("mouseenter",this.selector("day"),function(e){var a=t.$(this);a.hasClass("selectable")&&t.activate(a)}),this.accessbtn.on("click.mk",function(t){t.preventDefault()})},_validate:function(t){var e,s,i=this.$(t),n=i.data("format"),o=i.data("key"),r=i.val(),h=this.selected;return e=parseInt(r)||this.unformat(n,r),"number"!=typeof e||isNaN(e)||("month"===o&&(e<0||e>11)?e=null:"day"===o&&(e<0||e>a(this.isValid(h)?h:this.date))?e=null:"year"===o&&(s=h.getFullYear(),h.setFullYear(e),this.isValid(h)||(h.setFullYear(old),e=s)),"number"!=typeof e||isNaN(e))?(r=this.getValue(n),i.val(this.format(n,r)),this):(this.setValue(n,e,h),this.setValue(n,e),this.refresh(),this.isValid(h)&&this.emit("change"),this)},_click:function(t){var e=this.$(t.target),a=this.selector("day");return e.is(this.controls)?this._handleControl(t):(e=e.is(a)&&e||e.parent(a),void(e.length&&e.hasClass("selectable")&&this.select(e)))},_handleControl:function(t){var e=this.$(t.target);return e.hasClass("prev-mo")&&this.moveMonth(!0,!1)||e.hasClass("next-mo")&&this.moveMonth(!1,!1)||e.hasClass("prev-yr")&&this.moveYear(!0,!1)||e.hasClass("next-yr")&&this.moveYear(!1,!1)},_focus:function(t){var e=this.$(t),a=this.config.format.split(this.xSplit),s=0;e.parent(this.shadow).length&&(s=a.length-1),this.index=s,this.delay(function(){this.setSelection(s)})},_move:function(t,e,a){var s=a.call(this,t[0],e&&"previousSibling"||"nextSibling");if(s){if(s=this.$(s),s.hasClass("inactive"))return this._move(s,e,a);this.activate(s)}return this},_moveY:function(t,e){return this._move(t,e,function(i,n){var o,r=t.index(),h=i.parentNode&&i.parentNode[n],l=h&&h.childNodes[r],d=this.date;return l?l:(o=d.getDate(),d.setDate(1),d.setMonth(d.getMonth()+(e?-1:1)),y=e?o-7+a(d):7-(s(d)-o),d.setDate(y),void this.refresh(!0))})},_moveX:function(t,e){return this._move(t,e,function(t,s){if(t[s])return t[s];var i=t.parentNode&&t.parentNode[s],n=i&&i.childNodes[e&&i.childNodes.length-1||0],o=this.date;return n?n:(o.setMonth(o.getMonth()+(e?-1:1)),o.setDate(e?a(o):1),void this.refresh(!0))})},_keydownInput:function(t){var e=t.target,a=this.$(e),s=t.which,i=this.keycode,n=String.fromCharCode(s).toLowerCase(),o=a.data("key");if(!(s===i.tab||s===i.backspace||/\w/.test(n)&&a.hasClass("month")&&a.data("format").length>2||/\d/.test(n)))switch(t.preventDefault(),s){case i.up:case i.down:this.step(o,s===i.down),e.setSelectionRange(0,e.value.length);break;case i.left:case i.right:this._focusNext(e,s===i.left)}},_keydownCalendar:function(t,e){var s,i=t.which,n=this.keycode;if(i!==n.tab)switch(t.preventDefault(),s=this.activeDay,i){case n.up:case n.down:return e&&this._moveY(s,i===n.up);case n.left:case n.right:return e&&this._moveX(s,i===n.left);case n.esc:return console.info("hide calendar");case n.pageup:case n.pagedown:return this.moveMonth(i===n.pageup,!0);case n.enter:case n.space:return e&&this.select()||this._handleControl(t);case n.home:case n.end:e&&this.activate(i===n.home?1:a(this.date))}},_focusNext:function(t,e){var a,s=!1,i=[].slice.call(t.parentNode.childNodes);e&&i.reverse(),a=this.first(i,function(e){return s&&e.classList.contains(this.name+"-entry")?e:void(e===t&&(s=!0))}),a&&a.focus()},step:function(t,e){var a,s="year"===t&&this.year||"month"===t&&this.month||this.day,i=s.data("format"),n=this.getValue(i);n+=e?-1:1,a=this.setValue(i,n),s.val(a),"year"===t||"month"===t?this.refresh():this.activate(n)},data:function(){var t,e=this.config,a=e.formats,s=a.days.length,i=this.date,n=this,o=[];return e.format.replace(this.xSearch,function(e,s,i){t=/m/.test(s)&&"month"||/y/.test(s)&&"year"||"day",o.push({name:n.uid(),format:s,value:n.isValid()?n.format(s,n.getValue(s,n.selected)):"",placeholder:s,spacer:i.replace(/\s/g,"&nbsp;"),type:"text",id:t,label:n.format(a["label_"+t],{digit:s.length})})}),{inputs:o,date:e.fdate?this.dts(i,e.format):e.format,weeks:this.buildCalendar(i),title:this.format("caption",{month:this.format(a.month,i.getMonth()),year:this.format(a.year,i.getFullYear())}),days:this.map(this.formatmap.days,function(t){return{day:t,label:s<4&&t.slice(0,s)||t}})}},buildCalendar:function(t){var e,s,n,o,r,h,l=new Date,d=a(t),c=i(t),u=(this.config.rollover,[]);for(n={days:[]},l.setDate(1),l.setFullYear(t.getFullYear()),l.setMonth(t.getMonth()-1),o=l.getMonth(),r=l.getFullYear(),e=a(l),s=e-(c-1),h=0;s<=e;s++)n.days.push(this.buildDay(r,o,s,h++,!0));for(l.setFullYear(t.getFullYear()),l.setMonth(t.getMonth()),l.setDate(t.getDate()),o=t.getMonth(),r=t.getFullYear(),h=1;h<=d;h++)n.days.push(this.buildDay(r,o,h,c++,!1,h===l.getDate())),c>6&&(u.push(n),c=0,n={days:[]});if(0!==c)for(l.setMonth(o+1),o=l.getMonth(),r=l.getFullYear(),h=1;c<=6;c++)n.days.push(this.buildDay(r,o,h++,c,!0));return u.push(n),u},buildDay:function(t,e,a,s,i,n){var o=new Date;return{value:a,label:this.format("label",{day:a,month:this.format("mmmm",e),year:this.format("yyyy",t)}),active:n,inactive:i,selectable:!i,rollover:this.config.rollover,weekend:!s||s>5,day:this.formatmap.days[s],today:a===o.getDate()&&e===o.getMonth()&&t===o.getFullYear()}},activate:function(t){var e,a=this.activeDay;return e="number"==typeof t?this.days.filter('[data-value="'+t+'"]'):this.$(t),e.length&&!e.hasClass("active")&&(this.date.setDate(parseInt(e.data("value"),10)),a.removeClass("active"),e.addClass("active"),this.emit("activate",e)),this},select:function(t,e){var a,t;if(a=t?"number"==typeof t?this.days.filter('[data-value="'+t+'"]'):this.$(t):this.activeDay,!a.hasClass("disabled"))return this.activate(t),t=parseInt(a.data("value"),10),t!==this.selected.getDate()&&this.setDate(this.date)&&!e&&this.emit("change"),this},isValid:function(t){return t=t||this.selected,!isNaN(t.getTime())},setDate:function(t){var e,a,s,i=this.selected;return this.each([this.year,this.month,this.day],function(s,n){e=0===n&&"FullYear"||1===n&&"Month"||2===n&&"Date",a=t["get"+e](),i["set"+e](a),s.val(this.format(s.data("format")),a)}),this.rootinput.val(this.dts(i)),s=this.isValid(i),s&&(this.date.setDate(1),this.date.setFullYear(i.getFullYear()),this.date.setMonth(i.getMonth()),this.date.setDate(i.getDate()),this.refresh()),s},refresh:function(t){var e=this.calendar,a=this.html("body",{weeks:this.buildCalendar(this.date)});return this.node("body",e).remove(),this.node("table",e).append(a),this.updateLabel(),t&&this.node("body",e).focus(),this},updateLabel:function(){var t=this.config.formats,e=this.date;return this.heading.text(this.format("caption",{month:this.format(t.month,e.getMonth()),year:this.format(t.year,e.getFullYear())})),this},moveMonth:function(t,e){return this.date.setMonth(this.date.getMonth()+(t?-1:1)),this.refresh(e)},moveYear:function(t,e){return this.date.setFullYear(this.date.getFullYear()+(t?-1:1)),this.refresh(e)},setValue:function(t,e,s){var i,n=s||this.date;switch(t.slice(0,1)){case"d":i=a(n),e=e>i&&1||e>0&&e||i,n.setDate(e);break;case"m":e=e<0&&11||e<12&&e||0,n.setMonth(e);break;case"y":n.setFullYear(e)}return this.format(t,e)},getValue:function(t,e){var a=e||this.date;switch(t.slice(0,1)){case"y":return a.getFullYear();case"m":return a.getMonth();case"d":return t.length>2?a.getDay():a.getDate()}return NaN},format:function(t,e){if("object"==typeof e)return this.super(t,e);if("undefined"==typeof e&&(e=this.getValue(t)),isNaN(e))return t;var a,s=this.formatmap;switch(t){case"m":return e+1;case"mm":return++e<10&&"0"+e||e;case"mmm":return a=s.months[e].slice(0,3),a.charAt(0).toUpperCase()+a.slice(1);case"mmmm":return a=s.months[e],a.charAt(0).toUpperCase()+a.slice(1);case"d":return e;case"dd":return e<10&&"0"+e||e;case"yyyy":return e;case"yy":return e.toString().slice(2)}},unformat:function(t,e){var a=this.formatmap;switch(t){case"m":case"d":case"mm":case"dd":case"yy":case"yyyy":return parseInt(e,10);case"mmm":return e=e.toLowerCase(),this.first(a.months,function(t,a){if(t.indexOf(e)>-1)return a});case"mmmm":return a.months.indexOf(e.toLowerCase())}return NaN},std:function(t,e){var a,s=new Date,i=t.split(this.xSplit),e=(e||this.formats.native).split(this.xSplit);return s.setDate(1),this.each(e,function(t,e){a=parseInt(i[e],10),t.indexOf("m")>-1&&(a-=1),this.setValue(t,a,s)}),s},dts:function(t,e){t=t||this.date,e=e||this.config.formats.native;return this.each(e.split(this.xSplit),function(a){value=this.format(a,this.getValue(a,t)),e=e.replace(new RegExp(a),value)}),e},disable:function(){this.enabled&&(this.each([this.rootinput,this.day,this.month,this.year],function(t){t.prop("disabled",!0),t.addClass("disabled")}),this.calendar.addClass("disabled"))},enable:function(){this.disabled&&(this.each([this.rootinput,this.day,this.month,this.year],function(t){t.prop("disabled",!1),t.removeClass("disabled")}),this.calendar.removeClass("disabled"))}}),e.get("Datepicker")});
!function(t,e){if("function"==typeof define&&define.amd)define(["mk-ui"],function(i){return e(t,i)});else{if("object"!=typeof module||!module.exports)return e(t,t.Mk);module.exports=e(t,require("mk-ui"))}}("undefined"!=typeof window&&window||this,function(t,e){return e.create("Selectmenu",{name:"mk-sm",templates:{shadow:'<div class="{{$key}}-shadow{{if:classname}} {{classname}}{{/if:classname}}">\t\t\t\t\t{{template:trigger}}\t\t\t\t\t{{scope:list}}\t\t\t\t\t\t{{template:list}}\t\t\t\t\t{{/scope:list}}\t\t\t\t<div />',trigger:'<div class="{{$key}}-trigger {{if:disabled}} disabled{{/if:disabled}}" role="combobox" aria-haspopup="listbox">\t\t\t\t\t<input type="text" \t\t\t\t\t\tclass="{{$key}}-input" \t\t\t\t\t\treadonly \t\t\t\t\t\taria-autocomplete="list" \t\t\t\t\t\taria-readonly="true" \t\t\t\t\t\taria-disabled="{{disabled}}" \t\t\t\t\t\t{{if:multiple}}aria-multiselectable="true" {{/if:multiple}} \t\t\t\t\t\tvalue="{{label}}" /> \t\t\t\t</div>',list:'<ul id="{{id}}" class="{{$key}}-list" role="listbox">\t\t\t\t\t{{loop:items}}\t\t\t\t\t\t{{template:item}}\t\t\t\t\t{{/loop:items}}\t\t\t\t</ul>',item:'<li class="{{$key}}-item" data-level="{{level}}" role="presentation">\t\t\t\t\t{{template:option}}\t\t\t\t</li>',option:'<a id="{{id}}" \t\t\t\t\tclass="{{$key}}-{{tagname}}{{if:classname}} {{classname}}{{/if:classname}}" \t\t\t\t\trole="{{role}}" \t\t\t\t\thref="javascript: void(0);" \t\t\t\t\taria-selected="{{selected}}" \t\t\t\t\taria-disabled="{{disabled}}" \t\t\t\t\tdata-value="{{value}}">\t\t\t\t\t<span class="{{$key}}-label">\t\t\t\t\t\t{{label}}\t\t\t\t\t</span>\t\t\t\t\t<span class="{{$key}}-alt">{{alt}}</span>\t\t\t\t</a>',removable:'<option class="{{$key}}-removable" value="{{value}}" data-alt="{{alt}}">{{label}}</option>'},formats:{label:"Combobox",removable:"Clear",removableAlt:"{{if:selected}}<span>({{selected}} of {{total}})</span>{{/if:selected}}"},get rootelement(){return this.node("",this.root)},get element(){return this.rootelement[0]},get version(){return"v2.0.0"},get multiple(){return this.element.multiple},get disabled(){return this.element.disabled},get enabled(){return!this.disabled},get options(){return this.element.options||[]},get trigger(){return this.node("trigger",this.shadow)},get input(){return this.node("input",this.shadow)},get list(){return this.node("list",this.shadow)},get items(){return this.list.find(this.selector("item"))},get listOptions(){return this.list.find('[role="option"]')},get isHidden(){return"true"!==this.trigger.attr("aria-expanded")},get isOpen(){return!this.isHidden},get value(){return this.multiple?this.map(this.options,function(t){if(t.selected)return t.value}):this.element.value},verifyRoot:function(t){if(!this.node("",t).is("select"))throw new Error(":: Mk.Selectmenu - root must have a <select> node ::");return!0},define:function(t,e){this.verifyRoot(t)&&this.super(t,e)},configure:function(t){t=t||{};var e=this.rootelement,i=e.attr("aria-label")||this.formats.label;this.param("label","string",t,i,e),this.multiple&&(this.param("removable","boolean",t,!1,e),this.param("removableId","string",t,this.uid())),this.super(t)},mount:function(){var t=this.input,e=this.$('label[for="'+this.element.id+'"]');t.attr("id",this.uid()),this.rootelement.attr("aria-hidden","true"),e.length?e.attr("for",t.attr("id")):t.attr("aria-label",this.config.label),this.shadow.appendTo(this.root)},unmount:function(){this.rootelement.off("change.mk"),this.shadow.remove(),this.shadow=this.events=this.config=this.root=null},build:function(){this.device&&this.root.addClass("device"),this.config.removable&&this.buildRemovable(),this.shadow=this.html("shadow",this.data()).appendTo(this.root),this.transitions&&this.shadow.addClass("transitions");var t=this.list,e=t.find('[aria-selected="true"]');this.trigger.attr({"aria-controls":t.attr("id")||"","aria-activedescendant":e.attr("id")||""})},buildRemovable:function(){this.html("removable",{label:this.format("removable"),value:this.config.removableId,alt:this.getRemovableAlt()}).appendTo(this.element)},getRemovableAlt:function(){return this.multiple&&this.value.length>0?this.format("removableAlt",{selected:this.value.length,total:this.options.length}):""},updateRemovableAlt:function(){if(this.config.removable){var t=this.getRemovableAlt();this.$(this.options).filter(this.selector("removable")).attr("data-alt",t),this.items.find(this.selector("removable")).find(this.selector("alt")).html(t)}return this},bind:function(){var t=this;this.rootelement.on("change.mk",function(e){t.updateLabel(),t.emit("change",t.value)}),this.device||(this.bindInputEvents(),this.bindListEvents())},bindInputEvents:function(){var t=this,e=this.trigger,i=!1,s=!1;this.input.on("focus.mk",function(a){t.disabled||(s&&(s=!1,t.toggle()),e.addClass("focus"),i=!0)}).on("blur.mk",function(e){this.disabled||(i=!1,t.blur())}).on("mousedown.mk",function(e){s=!0,i&&(s=!1,t.toggle())}).on("keydown.mk",function(e){t._keydown(e)})},bindListEvents:function(){var t=this;this.list.on("mousedown.mk",function(t){t.preventDefault()}).on("click.mk",'[role="option"]',function(e){e.preventDefault(),t.list.hasClass("out")||t.select(this.getAttribute("data-value"))}).on("mouseenter.mk",'[role="option"]',function(e){t.list.hasClass("out")||t.activate(this)})},_keydown:function(t){if(!this.disabled){var e=t.which,i=this.keycode;switch(e){case i.enter:this._enter(t);break;case i.space:this._space(t);break;case i.esc:this._esc(t);break;case i.up:case i.down:t.preventDefault(),this.move(e===i.up);break;case i.tab:this.isOpen&&this._tab(t);break;default:e=String.fromCharCode(e),e&&this.search(e,!0)}}},_enter:function(t){t.preventDefault();var e=this.items.find(".active"),i=e.attr("data-value");if("true"!==e.attr("aria-selected"))this.select(i);else{if(!this.multiple)return this.show();this.deselect(i)}if(!this.multiple)return this.hide()},_space:function(t){return t.preventDefault(),this.isHidden?this.show():this._enter(t)},_esc:function(t){return t.preventDefault(),this.isOpen&&this.hide(),this},_tab:function(t){if(this.isOpen){t.preventDefault();var e=this.items.find(".active");!this.multiple&&e.length&&"true"!==e.attr("aria-selected")&&this.select(e.attr("data-value")),this.hide()}},blur:function(){if(this.disabled)return this.hide();var t=this.trigger;return t.removeClass("focus"),this.updateLabel().hide()},move:function(t){var e,i=this.items,s=this.items.find(".active")[0],a=this.listOptions,n=!1;if("undefined"==typeof s&&(s=i.find('[aria-selected="true"]')[0],"undefined"==typeof s&&(s=a[0],n=!0),this.activate(s)),n)e=s,s=null;else{var l=t&&-1||1;for(index=this.index(s)+l,e=a[index];e&&"true"===e.getAttribute("aria-disabled");)index+=l,e=a[index];"undefined"==typeof e&&(e=t&&a[0]||a[a.length-1])}e!==s&&(this.activate(e,!0),this.scrollTo(e,t))},search:function(t,e){if(this.enabled&&t){this._timer&&(clearTimeout(this._timer),this._timer=null),this.query=this.query||"",e?this.query+=t:this.query=t;var i=this.getElementByLabel(this.query),s=this;i&&this.activate(i,!0),this._timer=setTimeout(function(){s.query="",s._timer=null},500)}},index:function(t){return this.first(this.listOptions,function(e,i){if(e===t)return i})},getOptgroupValue:function(t){return this.map(t.childNodes||[],function(t){return t.value}).join("|||")},getElementByLabel:function(t){t=t.toLowerCase();var e,i=this.selector("label");return this.first(this.listOptions,function(s){if(e=(this.$(s).find(i).text()||"").toLowerCase(),e.indexOf(t)>-1)return s})},getElementsByValue:function(t){var e,i=this.listOptions,s={};return this.each(i,function(i){if(e=this.$(i),e.attr("data-value")===t)return s.option=this.getOptionByValue(t),s.item=e,!1}),s},getOptionByValue:function(t){return this.first(this.options,function(e){if(e.value===t)return e})},getLabelByElement:function(t){var e=this.$(t),i=e.length>0&&e[0].tagName.toLowerCase()||"";return"option"===i?e[0].text:e.find(this.selector("label")).text()},updateLabel:function(t){return this.input.val(this.label(t)),this},label:function(t){var e=typeof t;return"undefined"!==e?"string"===e?t:this.getLabelByElement(t):this.multiple?this.config.label:this.first(this.options,function(t){if(t.selected)return t.text})},data:function(){var t=[].slice.apply(this.element.classList);return t.splice(t.indexOf(this.name),1),{label:this.label(),classname:t.join(" "),multiple:this.multiple,disabled:this.disabled,list:{id:this.uid(),items:this.getOptionData()}}},getOptionData:function(t,e,i){return t=t||this.element.children||[],e=e||[],i=i||0,this.each(t,function(t){var s=t.tagName.toLowerCase(),a="option"===s&&"option"||this.multiple&&"option"||"presentation";e.push({role:a,tagname:s,level:i,classname:t.className,id:t.id||this.uid(),label:t.text||t.label,selected:t.selected||!1,disabled:t.disabled||!1,alt:t.getAttribute("data-alt"),value:t.value||this.getOptgroupValue(t)}),t.children&&t.children.length>0&&this.getOptionData(t.children,e,i+1)}),e},scrollTo:function(t,e){var i=this.$(t);if(i.length>0){var s=this.list[0],a=s.scrollTop,n=a,l=s.offsetHeight;offset=i[0].offsetTop,height=i[0].offsetHeight,offset+height>a+l?n=e===!1?offset-l+height:offset:e&&offset<a&&(n=offset),n!==a&&(s.scrollTop=n)}},show:function(){var t=this.trigger,e=this.list;return this.enabled&&this.isHidden&&(this.delay(function(){this.activate(),t.attr("aria-expanded","true"),e.addClass("in").attr("aria-hidden","false"),this.emit("show")}),this.transition(e,function(){e.removeClass("in")})),this},hide:function(){var t=this.trigger,e=this.list;return this.isOpen&&(this.delay(function(){e.addClass("out").attr("aria-hidden","true"),t.attr("aria-expanded","false"),this.emit("hide")}),this.transition(e,function(){e.removeClass("out")})),this},toggle:function(){return this.isHidden?this.show():this.hide()},activate:function(t,e){var i=!1,s=this.listOptions;void 0===t&&(t=s[0],i=!0,this.each(s,function(e){if("true"===e.getAttribute("aria-selected"))return t=e,!1}));var a=this.$(t);return a.length&&"true"!==a.attr("aria-disabled")&&(this.input.attr("aria-activedescendant",a.attr("id")),s.removeClass("active"),a.addClass("active"),i&&this.scrollTo(t),e&&this.updateLabel(t),this.emit("activate",a,e)),this},deselect:function(t,e){var i=!1;if(this.multiple){var s=this.getElementsByValue(t);s.option.selected&&(s.option.selected=!1,s.item.attr("aria-selected","false"),this.updateRemovableAlt(),e||this.emit("change",this.value),i=!0)}else this.hide();return i},deselectAll:function(t){return this.each(this.options,function(t){this.deselect(t.value,!0)}),t||this.emit("change",this.value),this},select:function(t,e){if(t===this.config.removableId)return this.deselectAll(e),!1;var i=this.getElementsByValue(t),s=this.multiple;return"undefined"==typeof i.option?this.selectGroup(t,e):!i.option.disabled&&(i.option.selected?(this.deselect(t,e),!1):(i.option.selected=!0,s||(this.listOptions.attr("aria-selected","false"),this.updateLabel()),i.item.attr("aria-selected","true"),this.input.attr("aria-activedescendant",i.item.attr("id")),this.updateRemovableAlt(),e||this.emit("change",this.value),s||this.hide(),!0))},selectGroup:function(t,e){var i=(t||"").split("|||"),s=0;return this.each(i,function(t){var e=this.getElementsByValue(t);e.option.selected?s++:this.select(t,!0)}),s===i.length&&this.each(i,function(t){this.deselect(t)}),e||this.emit("change",this.value),this},disable:function(){return this.element.disabled=!0,this.input.attr("aria-disabled","true"),this.trigger.addClass("disabled"),this.emit("disabled"),this.hide(),this},enable:function(){return this.element.disabled=!1,this.input.attr("aria-disabled","false"),this.trigger.removeClass("disabled"),this.emit("enabled"),this},update:function(){var t=this.data(),e=t.disabled&&"disable"||"enable",i=this.input,s=this.html("list",t.list);return this.items.remove(),this.list.append(s.find(this.selector("item"))),this[e](),this.param("removable","boolean",this.config,!1,this.rootelement),this.config.removable&&this.items.find(this.selector("removable")).length<1&&this.buildRemovable(),i.attr("aria-multiselectable",t.multiple&&"true"||"false"),i.val(this.label()),this.emit("update"),this}}),e.get("Selectmenu")});